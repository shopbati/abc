import{c as ce,r as u,j as e,C as de,X as te,T as se,P as ee,U as Q,A as pe,S as Ne,s as V,R as X}from"./index-PA-U-bDe.js";import{T as re,W as ae,u as we}from"./useClients-DasK2Ety.js";import{F as ue}from"./filter-DdEsn0sG.js";import{S as je,A as ne}from"./search-JuWKNxgf.js";import{C as be}from"./credit-card-CEXKdCC6.js";import{S as ie,T as fe}from"./trash-2-C5o9V7BT.js";import{u as ve}from"./useCompanies-CCO8W4uA.js";import{A as le,a as oe,X as H,C as K,b as Ce}from"./x-circle-sQ8k0x9P.js";import{C as ye}from"./calendar-CXFftYpA.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ce("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=ce("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=ce("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=ce("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),De=({clients:x,startDate:h,endDate:c,onDateRangeChange:g,onClientClick:D,onEdit:C,onAddNew:p,loading:R=!1,error:v})=>{const[F,m]=u.useState(""),[i,s]=u.useState(!1),r=x.filter(a=>a.name.toLowerCase().includes(F.toLowerCase())||a.email&&a.email.toLowerCase().includes(F.toLowerCase())),l=a=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),o=()=>{const a=x.reduce((L,P)=>L+P.totalReceived,0),N=x.reduce((L,P)=>L+P.totalSent,0),A=x.reduce((L,P)=>L+P.totalCommissions,0),T=a-N-A;return{totalReceived:a,totalSent:N,totalCommissions:A,totalBalance:T}},{totalReceived:j,totalSent:S,totalCommissions:_,totalBalance:E}=o(),t=(()=>{if(!h&&!c)return"Toutes les données";const a=(T,L=!1)=>L?new Date(T).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):new Date(T).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"}),N=()=>h&&c?h===c?`${a(h,!0)}`:`${a(h,!0)} - ${a(c,!0)}`:h?`À partir du ${a(h,!0)}`:c?`Jusqu'au ${a(c,!0)}`:"Période personnalisée",A=()=>h&&c?h===c?`Le ${a(h)}`:`Du ${a(h)} au ${a(c)}`:h?`À partir du ${a(h)}`:c?`Jusqu'au ${a(c)}`:"Période personnalisée";return{mobile:N(),desktop:A()}})(),b=()=>{const a=new Date,N=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-01`,A=new Date(a.getFullYear(),a.getMonth()+1,0).getDate(),T=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(A).padStart(2,"0")}`;g.setStartDate(N),g.setEndDate(T)},d=()=>{g.setStartDate(""),g.setEndDate("")},I=()=>{s(!i)};return R?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Chargement des clients..."})]}):v?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 border border-gray-200 text-center",children:[e.jsx("div",{className:"text-red-500 mb-3",children:"⚠️"}),e.jsx("p",{className:"text-red-600 mb-2",children:"Erreur lors du chargement"}),e.jsx("p",{className:"text-sm text-gray-500",children:v})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Clients"}),e.jsxs("button",{onClick:p,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Nouveau client"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 max-w-full min-w-0 overflow-hidden",children:[e.jsxs("button",{onClick:I,className:"w-full p-6 flex items-center justify-between text-left hover:bg-gray-50 transition-colors min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 min-w-0 flex-shrink",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(ue,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Filtrer par période"}),e.jsxs("p",{className:"text-xs text-gray-500 break-words",children:[x.length," client",x.length>1?"s":""," trouvé",x.length>1?"s":""]})]})]}),e.jsx(de,{className:`h-6 w-6 text-gray-400 transition-transform flex-shrink-0 ${i?"rotate-180":""}`})]}),i&&e.jsx("div",{className:"px-6 pb-6 space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between space-y-4 lg:space-y-0 min-w-0",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"hidden md:block text-sm text-gray-600 break-words",children:typeof t=="object"?t.desktop:t}),e.jsx("p",{className:"md:hidden text-sm text-gray-600 break-words",children:typeof t=="object"?t.mobile:t})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-end space-y-2 sm:space-y-0 sm:space-x-1 w-full sm:w-auto max-w-full min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-1 w-full sm:w-auto max-w-full min-w-0",children:[e.jsxs("div",{className:"flex flex-col w-20 sm:w-24 max-w-full min-w-0",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 truncate",children:"Début"}),e.jsx("input",{type:"date",value:h,onChange:a=>g.setStartDate(a.target.value),className:"px-1 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs w-full min-w-0 max-w-full"})]}),e.jsxs("div",{className:"flex flex-col w-20 sm:w-24 max-w-full min-w-0",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 truncate",children:"Fin"}),e.jsx("input",{type:"date",value:c,onChange:a=>g.setEndDate(a.target.value),className:"px-1 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs w-full min-w-0 max-w-full"})]})]}),e.jsxs("div",{className:"flex space-x-1 w-full sm:w-auto",children:[e.jsx("button",{onClick:b,className:"flex-1 sm:flex-none px-1 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors font-medium whitespace-nowrap",children:"Ce mois"}),e.jsxs("button",{onClick:d,className:"flex-1 sm:flex-none px-1 py-1 text-xs bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors font-medium flex items-center justify-center whitespace-nowrap",children:[e.jsx(te,{className:"h-3 w-3"}),"Effacer"]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total reçu"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tous clients"})]})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["+",l(j)]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Total envoyé"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Tous clients"})]})]}),e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:["-",l(S)]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Commissions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total perçu"})]})]}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["+",l(_)]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:`w-12 h-12 ${E>=0?"bg-blue-100":"bg-red-100"} rounded-xl flex items-center justify-center`,children:e.jsx(ae,{className:`h-6 w-6 ${E>=0?"text-blue-600":"text-red-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Solde actuel"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Total général"})]})]}),e.jsx("div",{className:`text-2xl font-bold ${E>=0?"text-blue-600":"text-red-600"}`,children:l(E)})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",value:F,onChange:a=>m(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Rechercher un client..."})]})}),e.jsx("div",{className:"hidden lg:block",children:r.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 border border-gray-200 text-center",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:x.length===0?"Aucun client trouvé":"Aucun résultat pour cette recherche"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(se,{className:"h-4 w-4 mr-1 text-green-500"}),"Total reçu"]})}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(re,{className:"h-4 w-4 mr-1 text-red-500"}),"Total envoyé"]})}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(ee,{className:"h-4 w-4 mr-1 text-orange-500"}),"Commissions"]})}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-medium text-gray-500 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(ae,{className:"h-4 w-4 mr-1 text-blue-500"}),"Solde actuel"]})}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>D(a),children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4",children:e.jsx(Q,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-gray-900",children:a.name}),a.email&&e.jsx("div",{className:"text-sm text-gray-500",children:a.email})]})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:"text-base font-semibold text-green-600",children:["+",l(a.totalReceived)]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:"text-base font-semibold text-red-600",children:["-",l(a.totalSent)]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:"text-base font-semibold text-orange-600",children:["-",l(a.totalCommissions)]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("span",{className:`text-base font-bold ${a.currentBalance>=0?"text-green-600":"text-red-600"}`,children:l(a.currentBalance)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsxs("button",{onClick:N=>{N.stopPropagation(),D(a)},className:"flex items-center px-3 py-1 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors text-sm font-medium",title:"Gérer les virements",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Virements"]}),e.jsx("button",{onClick:N=>{N.stopPropagation(),C(a)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors",title:"Modifier",children:e.jsx(ie,{className:"h-4 w-4"})})]})})]},a.id))})]})})})}),e.jsx("div",{className:"lg:hidden",children:r.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 border border-gray-200 text-center",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:x.length===0?"Aucun client trouvé":"Aucun résultat pour cette recherche"})]}):e.jsx("div",{className:"space-y-4",children:r.map(a=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>D(a),children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(Q,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 truncate",children:a.name}),a.email&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:a.email})]})]}),a.phone&&e.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:["📞 ",a.phone]}),e.jsx("div",{className:"space-y-1 text-sm mb-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Solde:"}),e.jsx("span",{className:`font-semibold ${a.currentBalance>=0?"text-green-600":"text-red-600"}`,children:l(a.currentBalance)})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:N=>{N.stopPropagation(),D(a)},className:"flex items-center text-blue-600 hover:text-blue-800 text-sm font-medium",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Gérer les virements"]}),e.jsx("button",{onClick:N=>{N.stopPropagation(),C(a)},className:"p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors",title:"Modifier",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})})},a.id))})})]})},Ee=({client:x,onSubmit:h,onCancel:c,loading:g=!1})=>{const[D,C]=u.useState(""),[p,R]=u.useState(""),[v,F]=u.useState(""),[m,i]=u.useState(!1),[s,r]=u.useState(null),l=!!x;u.useEffect(()=>{x?(C(x.name),R(x.email||""),F(x.phone||"")):(C(""),R(""),F("")),r(null)},[x]);const o=async j=>{if(j.preventDefault(),r(null),!D.trim()){r("Le nom du client est requis");return}i(!0);try{const S=await h({name:D.trim(),email:p.trim()||void 0,phone:v.trim()||void 0});S.success?c():r(S.error||"Erreur lors de la sauvegarde")}catch{r("Une erreur inattendue est survenue")}finally{i(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l?"Modifier le client":"Nouveau client"}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:o,className:"p-6 space-y-4",children:[s&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md flex items-center",children:[e.jsx(pe,{className:"h-4 w-4 text-red-500 mr-2"}),e.jsx("span",{className:"text-sm text-red-700",children:s})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom du client *"}),e.jsx("input",{type:"text",value:D,onChange:j=>C(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nom complet",disabled:m||g,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:p,onChange:j=>R(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"client@example.com",disabled:m||g})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Téléphone"}),e.jsx("input",{type:"tel",value:v,onChange:j=>F(j.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"+33 1 23 45 67 89",disabled:m||g})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors font-medium",disabled:m||g,children:"Annuler"}),e.jsxs("button",{type:"submit",disabled:m||g,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[m&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e.jsx(Ne,{className:"h-4 w-4 mr-2"}),m?"Sauvegarde...":"Sauvegarder"]})]})]})]})})},$e=x=>{const[h,c]=u.useState([]),[g,D]=u.useState(!0),[C,p]=u.useState(null),R=async()=>{try{D(!0),p(null);let s=V.from("transfers").select(`
          *,
          debit_company:companies!transfers_debit_company_id_fkey(id, name, rib),
          credit_company:companies!transfers_credit_company_id_fkey(id, name, rib)
        `).order("created_at",{ascending:!1});x&&(s=s.eq("client_id",x));const{data:r,error:l}=await s;if(l)throw l;c(r||[])}catch(s){p(s instanceof Error?s.message:"An error occurred"),console.error("Error fetching transfers:",s)}finally{D(!1)}},v=async s=>{try{p(null);const{transfer_date:r,...l}=s,o=s.commission_percentage||0;let j,S,_;s.transfer_type==="outgoing"?(j=s.amount,S=s.amount*(1+o/100),_=S-j):(j=s.amount,S=s.amount,_=0);const E={...l,amount:S,commission_percentage:o,commission_amount:_,net_amount:j,...r&&{created_at:new Date(r).toISOString()}},{data:$,error:t}=await V.from("transfers").insert([E]).select(`
          *,
          debit_company:companies!transfers_debit_company_id_fkey(id, name, rib),
          credit_company:companies!transfers_credit_company_id_fkey(id, name, rib)
        `).single();if(t)throw t;return c(b=>[$,...b]),{success:!0,data:$}}catch(r){const l=r instanceof Error?r.message:"Failed to create transfer";return p(l),console.error("Error creating transfer:",r),{success:!1,error:l}}},F=async(s,r)=>{try{p(null);const{data:l,error:o}=await V.from("transfers").update({status:r}).eq("id",s).select(`
          *,
          debit_company:companies!transfers_debit_company_id_fkey(id, name, rib),
          credit_company:companies!transfers_credit_company_id_fkey(id, name, rib)
        `).single();if(o)throw o;return c(j=>j.map(S=>S.id===s?l:S)),{success:!0,data:l}}catch(l){const o=l instanceof Error?l.message:"Failed to update transfer status";return p(o),console.error("Error updating transfer status:",l),{success:!1,error:o}}},m=async(s,r)=>{try{p(null);const{data:l,error:o}=await V.from("transfers").update(r).eq("id",s).select(`
          *,
          debit_company:companies!transfers_debit_company_id_fkey(id, name, rib),
          credit_company:companies!transfers_credit_company_id_fkey(id, name, rib)
        `).single();if(o)throw o;return c(j=>j.map(S=>S.id===s?l:S)),{success:!0,data:l}}catch(l){const o=l instanceof Error?l.message:"Failed to update transfer";return p(o),console.error("Error updating transfer:",l),{success:!1,error:o}}},i=async s=>{try{p(null);const{error:r}=await V.from("transfers").delete().eq("id",s);if(r)throw r;return c(l=>l.filter(o=>o.id!==s)),{success:!0}}catch(r){const l=r instanceof Error?r.message:"Failed to delete transfer";return p(l),console.error("Error deleting transfer:",r),{success:!1,error:l}}};return u.useEffect(()=>{R()},[x]),{transfers:h,loading:g,error:C,addTransfer:v,updateTransferStatus:F,updateTransfer:m,deleteTransfer:i,refetch:R}},Te=()=>{const[x,h]=u.useState([]),[c,g]=u.useState(!0),[D,C]=u.useState(null),p=async()=>{try{g(!0),C(null);const{data:m,error:i}=await V.from("commission_rates").select("*").eq("is_active",!0).order("rate",{ascending:!0});if(i)throw i;h(m||[])}catch(m){C(m instanceof Error?m.message:"An error occurred"),console.error("Error fetching commission rates:",m)}finally{g(!1)}},R=async m=>{try{C(null);const{data:i,error:s}=await V.from("commission_rates").insert([{rate:m}]).select().single();if(s)throw s;return h(r=>[...r,i].sort((l,o)=>l.rate-o.rate)),{success:!0,data:i}}catch(i){const s=i instanceof Error?i.message:"Failed to add commission rate";return C(s),console.error("Error adding commission rate:",i),{success:!1,error:s}}},v=async(m,i)=>{try{C(null);const{data:s,error:r}=await V.from("commission_rates").update(i).eq("id",m).select().single();if(r)throw r;return h(l=>l.map(o=>o.id===m?s:o)),{success:!0,data:s}}catch(s){const r=s instanceof Error?s.message:"Failed to update commission rate";return C(r),console.error("Error updating commission rate:",s),{success:!1,error:r}}},F=async m=>{try{C(null);const{error:i}=await V.from("commission_rates").delete().eq("id",m);if(i)throw i;return h(s=>s.filter(r=>r.id!==m)),{success:!0}}catch(i){const s=i instanceof Error?i.message:"Failed to delete commission rate";return C(s),console.error("Error deleting commission rate:",i),{success:!1,error:s}}};return u.useEffect(()=>{p()},[]),{commissionRates:x,loading:c,error:D,addCommissionRate:R,updateCommissionRate:v,deleteCommissionRate:F,refetch:p}},Re=({clientId:x,onSubmit:h,loading:c=!1})=>{const{companies:g}=ve(),{commissionRates:D,loading:C}=Te(),[p,R]=u.useState(""),[v,F]=u.useState(""),[m,i]=u.useState(""),[s,r]=u.useState("outgoing"),[l,o]=u.useState(5),[j,S]=u.useState(""),[_,E]=u.useState(()=>new Date().toISOString().split("T")[0]),[$,t]=u.useState(!1),[b,d]=u.useState(null),[I,a]=u.useState(!1),[N,A]=u.useState(!1),[T,L]=u.useState(""),[P,G]=u.useState(""),W=g.find(k=>k.id===p),y=g.find(k=>k.id===v),me=async k=>{if(k.preventDefault(),d(null),!p||!v||!m){d("Tous les champs obligatoires doivent être remplis");return}if(p===v){d("Les comptes à débiter et à créditer ne peuvent pas être identiques");return}const q=parseFloat(m);if(isNaN(q)||q<=0){d("Le montant doit être un nombre positif");return}t(!0);try{const f=await h({client_id:x,debit_company_id:p,credit_company_id:v,amount:q,transfer_type:s,commission_percentage:s==="outgoing"?l:0,note:j.trim()||void 0,transfer_date:_});f.success?(R(""),F(""),i(""),S(""),E(new Date().toISOString().split("T")[0])):d(f.error||"Erreur lors de la création du virement")}catch{d("Une erreur inattendue est survenue")}finally{t(!1)}},n=parseFloat(m)||0,w=n,U=s==="outgoing"?n*(1+l/100):n,O=s==="outgoing"?U-w:0,M=k=>k.trim()?g.filter(q=>q.name.toLowerCase().includes(k.toLowerCase())||q.rib.toLowerCase().includes(k.toLowerCase())):g,B=({label:k,selectedCompany:q,isOpen:f,onToggle:z,onSelect:xe,type:Z,searchTerm:J,onSearchChange:he})=>{const ge=M(J);return e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[k," *"]}),e.jsx("button",{type:"button",onClick:z,className:"w-full p-3 border border-gray-300 rounded-lg bg-white text-left hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",disabled:c||$,children:e.jsxs("div",{className:"flex items-center justify-between",children:[q?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center text-white font-semibold ${Z==="debit"?"bg-red-500":"bg-green-500"}`,children:q.name.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:q.name}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:q.rib})]})]}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Sélectionnez un compte"}),e.jsx(de,{className:`h-4 w-4 text-gray-400 transition-transform ${f?"rotate-180":""}`})]})}),f&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-gray-100 bg-gray-50",children:e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),e.jsx("input",{type:"text",value:J,onChange:Y=>he(Y.target.value),className:"w-full pl-7 pr-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-xs",placeholder:"Rechercher par nom ou RIB...",onClick:Y=>Y.stopPropagation()})]})}),ge.length===0?e.jsx("div",{className:"p-3 text-center text-gray-500 text-sm",children:J?"Aucun résultat trouvé":"Aucun compte disponible"}):ge.map(Y=>e.jsxs("button",{type:"button",onClick:()=>{xe(Y.id),he(""),z()},className:"w-full p-2 text-left hover:bg-gray-50 flex items-center space-x-2 border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center text-white text-xs font-semibold ${Z==="debit"?"bg-red-500":"bg-green-500"}`,children:Y.name.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:Y.name}),e.jsx("div",{className:"text-xs text-gray-500 font-mono",children:Y.rib})]})]},Y.id))]})]})};return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:s==="incoming"?e.jsx(le,{className:"h-4 w-4 text-green-600"}):e.jsx(oe,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s==="incoming"?"Virement entrant":"Virement sortant"}),e.jsx("p",{className:"text-xs text-gray-500",children:s==="incoming"?"Enregistrer un virement reçu":"Effectuer un virement avec commission"})]})]}),b&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start",children:[e.jsx(pe,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-red-700",children:b})]}),e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de virement *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{r("incoming"),o(0)},className:`p-2 border-2 rounded-lg transition-all flex items-center justify-center space-x-2 text-sm ${s==="incoming"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Entrant"})]}),e.jsxs("button",{type:"button",onClick:()=>r("outgoing"),className:`p-2 border-2 rounded-lg transition-all flex items-center justify-center space-x-2 text-sm ${s==="outgoing"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Sortant"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(B,{label:s==="incoming"?"Compte créditeur (expéditeur)":"Compte à débiter",selectedCompany:W,isOpen:I,onToggle:()=>{a(!I),A(!1)},onSelect:R,type:"debit",searchTerm:T,onSearchChange:L}),e.jsx(B,{label:s==="incoming"?"Compte à créditer (récepteur)":"Compte bénéficiaire",selectedCompany:y,isOpen:N,onToggle:()=>{A(!N),a(!1)},onSelect:F,type:"credit",searchTerm:P,onSearchChange:G})]}),e.jsxs("div",{className:`grid grid-cols-1 gap-4 ${s==="outgoing"?"md:grid-cols-3":"md:grid-cols-2"}`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date du virement *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"date",value:_,onChange:k=>E(k.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",disabled:c||$,required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Montant *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:m,onChange:k=>i(k.target.value),className:"w-full px-3 pr-8 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"0.00",disabled:c||$}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 text-sm",children:"€"})})]})]}),s==="outgoing"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commission à prélever *"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:l,onChange:k=>o(parseFloat(k.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none text-sm",disabled:c||$||C,children:D.map(k=>e.jsxs("option",{value:k.rate,children:[k.rate,"%"]},k.id))}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx(ee,{className:"h-3 w-3 text-gray-400"})})]})]})]}),s==="outgoing"&&n>0&&e.jsx("div",{className:"p-2 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-green-600",children:"Montant net à transférer:"}),e.jsx("span",{className:"font-medium",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(w)})]}),e.jsxs("div",{className:"flex justify-between text-amber-700",children:[e.jsxs("span",{children:["Notre commission (",l,"%):"]}),e.jsxs("span",{children:["+",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(O)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-amber-300 pt-1 font-semibold text-blue-700",children:[e.jsx("span",{children:"Montant total débité:"}),e.jsx("span",{className:"font-bold",children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(U)})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note (optionnel)"}),e.jsx("textarea",{value:j,onChange:k=>S(k.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none text-sm",rows:2,placeholder:"Ajouter une note pour ce virement...",disabled:c||$})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{type:"submit",disabled:$||c||!p||!v||!m,className:`px-4 py-2 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center text-sm ${s==="incoming"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"}`,children:[$&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e.jsx(Fe,{className:"h-3 w-3 mr-1"}),$?"Création...":s==="incoming"?"Enregistrer le virement":"Créer le virement"]})})]})]})},Me=({transfers:x,onStatusUpdate:h,onUpdate:c,onDelete:g,loading:D=!1,error:C})=>{const[p,R]=u.useState(new Set),[v,F]=u.useState(null),[m,i]=u.useState(""),[s,r]=u.useState(""),l=t=>{const b=new Set(p);b.has(t)?b.delete(t):b.add(t),R(b)},o=t=>{F(t.id),i(t.created_at.split("T")[0]),r(t.note||""),window.innerWidth<1024&&R(b=>new Set([...b,t.id]))},j=()=>{F(null),i(""),r("")},S=async()=>{if(!v||!c)return;const t={},b=x.find(d=>d.id===v);m!==(b==null?void 0:b.created_at.split("T")[0])&&(t.created_at=new Date(m).toISOString()),s!==((b==null?void 0:b.note)||"")&&(t.note=s),Object.keys(t).length>0?(await c(v,t)).success&&j():j()};if(D)return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Chargement des virements..."})]});if(C)return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(H,{className:"h-6 w-6 text-red-500"})}),e.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Erreur lors du chargement"}),e.jsx("p",{className:"text-sm text-gray-500",children:C})]});if(x.length===0)return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ne,{className:"h-8 w-8 text-gray-300"})}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Aucun virement trouvé"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Les virements apparaîtront ici"})]});const _=t=>{switch(t){case"completed":return{icon:K,badgeColor:"bg-green-100 text-green-800 border-green-200",label:"Terminé"};case"failed":return{icon:H,badgeColor:"bg-red-100 text-red-800 border-red-200",label:"Échoué"};default:return{icon:Ce,badgeColor:"bg-orange-100 text-orange-800 border-orange-200",label:"En attente"}}},E=t=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(t),$=t=>new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"hidden md:block px-6 py-4 border-b border-gray-100 bg-gray-50",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3",children:e.jsx(ne,{className:"h-4 w-4 text-blue-600"})}),"Historique des virements"]})}),e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mouvement"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Note"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Montant"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:x.map(t=>{var N,A;const b=_(t.status),d=t.transfer_type==="incoming",I=b.icon,a=v===t.id;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:a?e.jsx("input",{type:"date",value:m,onChange:T=>i(T.target.value),className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",onClick:T=>T.stopPropagation()}):e.jsx("div",{className:"text-sm",children:e.jsx("div",{className:"font-medium text-gray-900",children:$(t.created_at)})})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm font-medium ${d?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[d?e.jsx(le,{className:"h-4 w-4 mr-1"}):e.jsx(oe,{className:"h-4 w-4 mr-1"}),d?"Entrant":"Sortant"]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"text-sm",children:e.jsxs("div",{className:"font-medium text-gray-900",children:[(N=t.debit_company)==null?void 0:N.name," → ",(A=t.credit_company)==null?void 0:A.name]})})}),e.jsx("td",{className:"px-4 py-4",children:a?e.jsx("textarea",{value:s,onChange:T=>r(T.target.value),className:"w-full px-2 py-1 border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-sm",rows:2,placeholder:"Note du virement...",onClick:T=>T.stopPropagation()}):e.jsx("div",{className:"text-sm text-gray-700 max-w-xs",children:t.note?e.jsx("span",{className:"block truncate",title:t.note,children:t.note}):e.jsx("span",{className:"text-gray-400 italic text-xs",children:"Aucune note"})})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:`font-bold ${d?"text-green-600":"text-red-600"}`,children:[d?"+":"-",E(t.net_amount||t.amount)]}),!d&&t.commission_amount>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:["Commission: ",E(t.commission_amount)]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${b.badgeColor}`,children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),b.label]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:a?e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx("button",{onClick:S,className:"p-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",title:"Sauvegarder",children:e.jsx(K,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:j,className:"p-1.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors",title:"Annuler",children:e.jsx(H,{className:"h-3.5 w-3.5"})})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[c&&e.jsx("button",{onClick:()=>o(t),className:"p-1.5 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors",title:"Modifier le virement",children:e.jsx(ie,{className:"h-3.5 w-3.5"})}),g&&e.jsx("button",{onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer ce virement ?")&&g(t.id)},className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Supprimer le virement",children:e.jsx(fe,{className:"h-3.5 w-3.5"})}),h&&t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(t.id,"completed"),className:"p-1.5 bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",title:"Valider",children:e.jsx(K,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>h(t.id,"failed"),className:"p-1.5 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",title:"Rejeter",children:e.jsx(H,{className:"h-3.5 w-3.5"})})]})]})})]},t.id)})})]})}),e.jsx("div",{className:"lg:hidden divide-y divide-gray-100",children:x.map(t=>{var a,N,A,T,L,P,G,W;const b=_(t.status),d=t.transfer_type==="incoming",I=p.has(t.id);return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute top-4 right-4 z-10 flex items-center space-x-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${b.badgeColor}`,children:b.label}),c&&e.jsx("button",{onClick:y=>{y.stopPropagation(),o(t)},className:"p-1 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors",title:"Modifier le virement",children:e.jsx(ie,{className:"h-3.5 w-3.5"})}),g&&e.jsx("button",{onClick:y=>{y.stopPropagation(),confirm("Êtes-vous sûr de vouloir supprimer ce virement ?")&&g(t.id)},className:"p-1 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Supprimer le virement",children:e.jsx(fe,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>l(t.id),children:[e.jsxs("div",{className:"flex items-center justify-between pr-32",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-500 w-16 flex-shrink-0 cursor-pointer",children:v===t.id?e.jsx("input",{type:"date",value:m,onChange:y=>i(y.target.value),className:"w-full text-xs border border-gray-300 rounded px-1 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500",onClick:y=>y.stopPropagation()}):$(t.created_at)}),e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${d?"bg-green-50":"bg-red-50"}`,children:d?e.jsx(le,{className:"h-5 w-5 text-green-600"}):e.jsx(oe,{className:"h-5 w-5 text-red-600"})}),e.jsx("div",{className:"flex-1 min-w-0 hidden md:block",children:e.jsxs("div",{className:"font-medium text-gray-900 truncate",children:[(a=t.debit_company)==null?void 0:a.name," → ",(N=t.credit_company)==null?void 0:N.name]})})]}),e.jsxs("div",{className:`text-lg font-bold ${d?"text-green-600":"text-red-600"} flex-shrink-0`,children:[d?"+":"-",E(t.net_amount||t.amount)]})]}),e.jsx("div",{className:"md:hidden mt-2 mb-2",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:[(A=t.debit_company)==null?void 0:A.name," → ",(T=t.credit_company)==null?void 0:T.name]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(de,{className:`h-4 w-4 text-gray-400 transition-transform ${I?"rotate-180":""}`})})]}),I&&e.jsxs("div",{className:"px-4 pb-4 bg-gray-50 border-t border-gray-100",children:[v===t.id&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date du virement"}),e.jsx("input",{type:"date",value:m,onChange:y=>i(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note"}),e.jsx("textarea",{value:s,onChange:y=>r(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2,placeholder:"Note du virement..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:S,className:"flex items-center space-x-1 px-3 py-1 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors text-sm",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Sauvegarder"})]}),e.jsxs("button",{onClick:j,className:"flex items-center space-x-1 px-3 py-1 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors text-sm",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Annuler"})]})]})]})}),e.jsxs("div",{className:"space-y-3 pt-3",children:[v!==t.id&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:$(t.created_at)})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"De :"}),e.jsx("span",{className:"font-medium text-gray-900",children:(L=t.debit_company)==null?void 0:L.name})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Vers :"}),e.jsx("span",{className:"font-medium text-gray-900",children:(P=t.credit_company)==null?void 0:P.name})]}),e.jsxs("div",{className:"flex justify-between items-center pt-1 border-t border-gray-200",children:[e.jsx("span",{className:"text-gray-600",children:"RIB source :"}),e.jsx("span",{className:"font-mono text-xs text-gray-700",children:(G=t.debit_company)==null?void 0:G.rib})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"RIB destination :"}),e.jsx("span",{className:"font-mono text-xs text-gray-700",children:(W=t.credit_company)==null?void 0:W.rib})]})]})}),t.note&&v!==t.id&&e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Note: "}),t.note]}),!d&&e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-200",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Montant net transféré:"}),e.jsx("span",{className:"font-medium text-gray-900",children:E(t.net_amount||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-gray-600",children:["Commission (",t.commission_percentage,"%):"]}),e.jsx("span",{className:"font-medium text-orange-600",children:E(t.commission_amount||0)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Total débité:"}),e.jsx("span",{className:"font-bold text-red-600",children:E(t.amount)})]})]})}),h&&t.status==="pending"&&e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsxs("button",{onClick:y=>{y.stopPropagation(),h(t.id,"completed")},className:"flex items-center space-x-1 px-3 py-1 bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors text-sm",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Valider"})]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),h(t.id,"failed")},className:"flex items-center space-x-1 px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 transition-colors text-sm",children:[e.jsx(H,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Rejeter"})]})]})]})]})]},t.id)})})]})},Ae=({client:x,onBack:h})=>{const{transfers:c,loading:g,error:D,addTransfer:C,updateTransferStatus:p,updateTransfer:R,deleteTransfer:v}=$e(x.id),[F,m]=X.useState(!1);X.useState(!1);const[i,s]=X.useState(()=>{const n=new Date;return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-01`}),[r,l]=X.useState(()=>{const n=new Date,w=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(w).padStart(2,"0")}`}),o=X.useMemo(()=>!i&&!r?c:c.filter(n=>{const w=new Date(n.created_at).toISOString().split("T")[0];return!(i&&w<i||r&&w>r)}),[c,i,r]),j=o.filter(n=>n.transfer_type==="incoming"&&n.status==="completed"),S=()=>{if(!i&&!r)return"Toutes les données";const n=(O,M=!1)=>M?new Date(O).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):new Date(O).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"}),w=()=>i&&r?i===r?`${n(i,!0)}`:`${n(i,!0)} - ${n(r,!0)}`:i?`À partir du ${n(i,!0)}`:r?`Jusqu'au ${n(r,!0)}`:"Période personnalisée",U=()=>i&&r?i===r?`Le ${n(i)}`:`Du ${n(i)} au ${n(r)}`:i?`À partir du ${n(i)}`:r?`Jusqu'au ${n(r)}`:"Période personnalisée";return{mobile:w(),desktop:U()}},_=S(),E=()=>{const n=new Date,w=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-01`,U=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),O=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(U).padStart(2,"0")}`;s(w),l(O)},$=()=>{s(""),l("")},t=async n=>await C(n),b=async(n,w)=>{await p(n,w)},d=async n=>{await v(n)},I=async(n,w)=>await R(n,w),a=n=>new Date(n).toLocaleDateString("fr-FR"),N=n=>new Intl.NumberFormat("fr-FR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(n),A=()=>{const n=T(),w=window.open("","_blank","width=1,height=1,left=-1000,top=-1000,scrollbars=no,resizable=no");w&&(w.document.write(n),w.document.close(),setTimeout(()=>{w.print(),w.onafterprint=()=>w.close(),setTimeout(()=>{w.closed||w.close()},500)},250))},T=()=>{const n=o.filter(f=>f.status==="completed"),w=n.filter(f=>f.transfer_type==="incoming").reduce((f,z)=>f+(z.net_amount||z.amount||0),0),U=n.filter(f=>f.transfer_type==="outgoing").reduce((f,z)=>f+(z.net_amount||0),0),O=n.filter(f=>f.transfer_type==="outgoing").reduce((f,z)=>f+(z.commission_amount||0),0),M=w-U-O,B=S(),k=typeof B=="object"?B.desktop:B,q=o.map(f=>{var Z,J;const z=f.transfer_type==="incoming",xe=f.status==="completed"?"Terminé":f.status==="failed"?"Échoué":"En attente";return`
        <tr>
          <td>${a(f.created_at)}</td>
          <td>${z?"Entrant":"Sortant"}</td>
          <td>${((Z=f.debit_company)==null?void 0:Z.name)||""}</td>
          <td>${((J=f.credit_company)==null?void 0:J.name)||""}</td>
          <td>${f.note||"-"}</td>
          <td style="text-align: right;">${z?"+":"-"}${N(f.net_amount||f.amount)}</td>
          <td style="text-align: right;">${!z&&f.commission_amount>0?N(f.commission_amount):"-"}</td>
          <td style="text-align: center;">${xe}</td>
        </tr>
      `}).join("");return`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="utf-8">
          <title>Relevé de mouvements - ${x.name}</title>
          <style>
            @media print {
              @page {
                margin: 15px;
                size: A4;
              }
              
              body {
                font-family: Arial, sans-serif;
                font-size: 11px;
                line-height: 1.3;
                color: #000;
                margin: 0;
                padding: 0;
              }
              
              .header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 2px solid #000;
                padding-bottom: 10px;
              }
              
              .header h1 {
                font-size: 18px;
                font-weight: bold;
                margin: 0 0 5px 0;
              }
              
              .header h2 {
                font-size: 14px;
                font-weight: normal;
                margin: 0;
                color: #666;
              }
              
              .period-info {
                text-align: center;
                margin-bottom: 15px;
                font-weight: bold;
              }
              
              table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
              }
              
              th, td {
                border: 1px solid #ccc;
                padding: 4px 6px;
                vertical-align: top;
              }
              
              th {
                background-color: #f0f0f0;
                font-weight: bold;
                text-align: center;
                font-size: 10px;
              }
              
              td {
                font-size: 10px;
              }
              
              .summary {
                border: 2px solid #000;
                padding: 10px;
                margin-top: 20px;
              }
              
              .summary h3 {
                margin: 0 0 10px 0;
                font-size: 14px;
                text-align: center;
              }
              
              .summary-table {
                border: none;
                margin-bottom: 0;
              }
              
              .summary-table td {
                border: none;
                padding: 3px 0;
                font-weight: bold;
              }
              
              .summary-table .label {
                width: 60%;
              }
              
              .summary-table .amount {
                width: 40%;
                text-align: right;
              }
              
              .positive { color: #059669; }
              .negative { color: #DC2626; }
              .neutral { color: #000; }
              
              .footer {
                position: fixed;
                bottom: 0;
                width: 100%;
                text-align: center;
                font-size: 9px;
                color: #666;
                border-top: 1px solid #ccc;
                padding-top: 5px;
              }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>RELEVÉ DE MOUVEMENTS</h1>
            <h2>${x.name}</h2>
          </div>
          
          <div class="period-info">
            Période: ${k}
          </div>
          
          <table>
            <thead>
              <tr>
                <th style="width: 12%;">Date</th>
                <th style="width: 10%;">Type</th>
                <th style="width: 18%;">Compte Débiteur</th>
                <th style="width: 18%;">Compte Créditeur</th>
                <th style="width: 20%;">Note</th>
                <th style="width: 12%;">Montant</th>
                <th style="width: 10%;">Commission</th>
                <th style="width: 10%;">Statut</th>
              </tr>
            </thead>
            <tbody>
              ${q}
            </tbody>
          </table>
          
          <div class="summary">
            <h3>RÉSUMÉ DE LA PÉRIODE</h3>
            <table class="summary-table">
              <tr>
                <td class="label">Total Reçu (Virements entrants):</td>
                <td class="amount positive">+${N(w)}</td>
              </tr>
              <tr>
                <td class="label">Total Envoyé (Virements sortants):</td>
                <td class="amount negative">-${N(U)}</td>
              </tr>
              <tr>
                <td class="label">Total Commissions:</td>
                <td class="amount negative">-${N(O)}</td>
              </tr>
              <tr style="border-top: 2px solid #000;">
                <td class="label" style="font-size: 12px; padding-top: 8px;">SOLDE NET DE LA PÉRIODE:</td>
                <td class="amount ${M>=0?"positive":"negative"}" style="font-size: 12px; padding-top: 8px;">
                  ${N(M)}
                </td>
              </tr>
              <tr>
                <td class="label">Nombre total de mouvements:</td>
                <td class="amount neutral">${o.length}</td>
              </tr>
            </table>
          </div>
          
          <div class="footer">
            ABC Gestion - Relevé généré le ${new Date().toLocaleDateString("fr-FR")} à ${new Date().toLocaleTimeString("fr-FR")}
          </div>
        </body>
      </html>
    `},L=()=>{const n=o.filter(M=>M.status==="completed"),w=n.filter(M=>M.transfer_type==="incoming").reduce((M,B)=>M+(B.net_amount||0),0),U=n.filter(M=>M.transfer_type==="outgoing").reduce((M,B)=>M+(B.net_amount||0),0),O=n.filter(M=>M.transfer_type==="outgoing").reduce((M,B)=>M+(B.commission_amount||0),0);return{totalIncoming:w,totalOutgoing:U,totalCommissions:O,balance:w-U-O}},{totalIncoming:P,totalOutgoing:G,totalCommissions:W,balance:y}=L(),me=()=>{m(!F)};return e.jsxs("div",{className:"space-y-4 md:space-y-6 max-w-full min-w-0 overflow-x-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx(Se,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:x.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestion des virements"})]})]})]}),e.jsxs("button",{onClick:A,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",title:"Imprimer le relevé",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Imprimer"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-green-900",children:"Total Reçu"}),e.jsx("p",{className:"text-sm text-green-700",children:"Virements entrants"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-green-700",children:["+",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(P)]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-rose-50 border border-red-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900",children:"Total Envoyé"}),e.jsx("p",{className:"text-sm text-red-700",children:"Virements sortants"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-red-700",children:["-",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(G)]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:e.jsx(ee,{className:"h-6 w-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900",children:"Commissions"}),e.jsx("p",{className:"text-sm text-orange-700",children:"Total perçu"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-orange-700",children:["-",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(W)]})]}),e.jsxs("div",{className:`${y>=0?"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200":"bg-gradient-to-r from-red-50 to-rose-50 border-red-200"} border rounded-2xl p-6 shadow-sm`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:`w-12 h-12 ${y>=0?"bg-blue-100":"bg-red-100"} rounded-xl flex items-center justify-center`,children:e.jsx(ae,{className:`h-6 w-6 ${y>=0?"text-blue-600":"text-red-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-semibold ${y>=0?"text-blue-900":"text-red-900"}`,children:"Solde Net"}),e.jsx("p",{className:`text-sm ${y>=0?"text-blue-700":"text-red-700"}`,children:"Période filtrée"})]})]}),e.jsx("div",{className:`text-3xl font-bold ${y>=0?"text-blue-700":"text-red-700"}`,children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(y)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-5 gap-6 max-w-full min-w-0",children:[e.jsxs("div",{className:"xl:col-span-1 bg-white rounded-2xl shadow-sm border border-gray-200 p-6 max-w-full min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(ae,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Solde disponible"}),e.jsx("p",{className:"hidden md:block text-xs text-gray-600 break-words",children:i||r?typeof _=="object"?_.desktop:_:"Montant total"}),e.jsx("p",{className:"md:hidden text-xs text-gray-600 break-words",children:i||r?typeof _=="object"?_.mobile:_:"Total"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${y>=0?"text-green-600":"text-red-600"}`,children:new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(y)}),e.jsx("div",{className:"text-sm text-gray-600 mt-1 font-medium",children:y>=0?"Solde positif":"Solde négatif"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center text-green-600 min-w-0",children:[e.jsx("div",{className:"w-5 h-5 bg-green-100 rounded-lg flex items-center justify-center mr-2",children:e.jsx(se,{className:"h-3 w-3 text-green-600"})}),e.jsx("span",{className:"truncate font-medium",children:"Reçu"})]}),e.jsxs("span",{className:"font-bold text-green-600 ml-2",children:["+",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(P)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsxs("div",{className:"flex items-center text-red-600 min-w-0",children:[e.jsx("div",{className:"w-5 h-5 bg-red-100 rounded-lg flex items-center justify-center mr-2",children:e.jsx(re,{className:"h-3 w-3 text-red-600"})}),e.jsx("span",{className:"truncate font-medium",children:"Envoyé"})]}),e.jsxs("span",{className:"font-bold text-red-600 ml-2",children:["-",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(G)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center text-orange-600 min-w-0",children:[e.jsx("div",{className:"w-5 h-5 bg-orange-100 rounded-lg flex items-center justify-center mr-2",children:e.jsx(ee,{className:"h-3 w-3 text-orange-600"})}),e.jsx("span",{className:"truncate font-medium",children:"Commissions"})]}),e.jsxs("span",{className:"font-bold text-orange-600 ml-2",children:["-",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(W)]})]})]}),y<1e3&&y>0&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-3 mt-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-amber-600 text-xs font-medium",children:"⚠️ Solde faible - Moins de 1 000€ restant"})})}),y<=0&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-3 mt-3",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-red-600 text-xs font-medium",children:"❌ Solde insuffisant pour nouveaux virements"})})})]}),e.jsxs("div",{className:"hidden xl:block border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ue,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Filtrer par période"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-600",children:typeof _=="object"?_.desktop:_}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Début"}),e.jsx("input",{type:"date",value:i,onChange:n=>s(n.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Fin"}),e.jsx("input",{type:"date",value:r,onChange:n=>l(n.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs"})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:E,className:"flex-1 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors font-medium",children:"Ce mois"}),e.jsx("button",{onClick:$,className:"flex-1 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors font-medium flex items-center justify-center",children:e.jsx(te,{className:"h-3 w-3"})})]})]})]})]})]}),e.jsxs("div",{className:"xl:hidden bg-white rounded-2xl shadow-sm border border-gray-100 p-4 max-w-full min-w-0 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Période"})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[o.length," virement",o.length>1?"s":""]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Début"}),e.jsx("input",{type:"date",value:i,onChange:n=>s(n.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Fin"}),e.jsx("input",{type:"date",value:r,onChange:n=>l(n.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 bg-white text-xs"})]})]}),e.jsxs("div",{className:"flex space-x-1 mt-2",children:[e.jsx("button",{onClick:E,className:"flex-1 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors font-medium",children:"Ce mois"}),e.jsxs("button",{onClick:$,className:"flex-1 px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition-colors font-medium flex items-center justify-center",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Effacer"]})]})]}),e.jsxs("div",{className:"xl:col-span-4 bg-white rounded-2xl shadow-sm border border-gray-100 max-w-full min-w-0 overflow-hidden",children:[e.jsxs("button",{onClick:me,className:"xl:hidden w-full p-6 flex items-center justify-between text-left hover:bg-gray-50 transition-colors min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center",children:e.jsx(ne,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Gérer les virements"}),e.jsx("p",{className:"text-xs text-gray-600 break-words",children:"Créer nouveaux virements"})]})]}),e.jsx(de,{className:`h-6 w-6 text-gray-400 transition-transform flex-shrink-0 ${F?"rotate-180":""}`})]}),e.jsx("div",{className:"hidden xl:block p-6 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center",children:e.jsx(ne,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Gérer les virements"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Créer nouveaux virements"})]})]})}),(F||window.innerWidth>=1280)&&e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx(Re,{clientId:x.id,onSubmit:t,loading:g,incomingTransfers:j,allTransfers:o})})]})]}),e.jsx("div",{className:"max-w-full min-w-0 overflow-hidden",children:e.jsx(Me,{transfers:o,onStatusUpdate:b,onUpdate:I,onDelete:d,loading:g,error:D})})]})},Ve=()=>{const[x,h]=u.useState(()=>{const d=new Date;return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-01`}),[c,g]=u.useState(()=>{const d=new Date,I=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(I).padStart(2,"0")}`}),{clients:D,loading:C,error:p,addClient:R,updateClient:v,deleteClient:F,refetch:m}=we(x,c),[i,s]=u.useState(!1),[r,l]=u.useState(null),[o,j]=u.useState(null);X.useEffect(()=>{if(o===null){const d=setTimeout(()=>{m()},100);return()=>clearTimeout(d)}},[o]);const S=()=>{l(null),s(!0)},_=d=>{l(d),s(!0)},E=async d=>r?await v(r.id,d):await R(d),$=()=>{s(!1),l(null)},t=d=>{j(d)},b=()=>{j(null)};return o?e.jsx(Ae,{client:o,onBack:b}):e.jsxs("div",{children:[e.jsx(De,{clients:D,startDate:x,endDate:c,onDateRangeChange:{setStartDate:h,setEndDate:g},onClientClick:t,onEdit:_,onAddNew:S,loading:C,error:p}),i&&e.jsx(Ee,{client:r,onSubmit:E,onCancel:$,loading:C})]})};export{Ve as default};
