import{r as c,u as D,j as e,a as $,B as S,b as N,T as E,P as R,U as _}from"./index-PA-U-bDe.js";import{u as M,W as T,T as B}from"./useClients-DasK2Ety.js";import{u as v}from"./useAllTransfers-BM15H4Io.js";import{u as F}from"./useCommissions-DoETA6jE.js";import{u as A}from"./useCompanies-CCO8W4uA.js";import{C as I}from"./calendar-CXFftYpA.js";import{A as w,a as C,b as U,X as V,C as W}from"./x-circle-sQ8k0x9P.js";const L=({data:d})=>{const g=c.useRef(null),o=c.useRef(null),{theme:u}=D();return c.useEffect(()=>{if(!g.current||!window.Chart)return;const x=g.current.getContext("2d");o.current&&o.current.destroy();const h=u==="dark",n=h?"#E5E7EB":"#374151",p=h?"#374151":"#E5E7EB";return o.current=new window.Chart(x,{type:"bar",data:{labels:d.labels,datasets:[{label:"Virements Reçus",data:d.incoming,backgroundColor:"rgba(34, 197, 94, 0.8)",borderColor:"rgb(34, 197, 94)",borderWidth:1},{label:"Virements Envoyés",data:d.outgoing,backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"rgb(239, 68, 68)",borderWidth:1},{label:"Commissions",data:d.commissions,backgroundColor:"rgba(249, 115, 22, 0.8)",borderColor:"rgb(249, 115, 22)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:n}},title:{display:!0,text:"Activité Mensuelle",color:n}},scales:{x:{ticks:{color:n},grid:{color:p}},y:{beginAtZero:!0,ticks:{color:n,callback:function(y){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(y)}},grid:{color:p}}}}}),()=>{o.current&&o.current.destroy()}},[d,u]),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors duration-200",children:e.jsx("div",{className:"h-80",children:e.jsx("canvas",{ref:g})})})},P=({data:d})=>{const g=c.useRef(null),o=c.useRef(null),{theme:u}=D();return c.useEffect(()=>{if(!g.current||!window.Chart)return;const x=g.current.getContext("2d");o.current&&o.current.destroy();const h=d.completed+d.pending+d.failed;if(h===0)return;const p=u==="dark"?"#E5E7EB":"#374151";return o.current=new window.Chart(x,{type:"doughnut",data:{labels:["Terminés","En Attente","Échoués"],datasets:[{data:[d.completed,d.pending,d.failed],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(249, 115, 22, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(34, 197, 94)","rgb(249, 115, 22)","rgb(239, 68, 68)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:p}},title:{display:!0,text:"Statut des Virements",color:p},tooltip:{callbacks:{label:function(y){const f=y.parsed,b=(f/h*100).toFixed(1);return`${y.label}: ${f} (${b}%)`}}}}}}),()=>{o.current&&o.current.destroy()}},[d,u]),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 transition-colors duration-200",children:e.jsx("div",{className:"h-80",children:e.jsx("canvas",{ref:g})})})},H=()=>{const[d]=c.useState(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-01`}),[g]=c.useState(()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth()+1,0).getDate();return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`}),{clients:o}=M(),{companies:u}=A(),{transfers:x}=v(d,g);F(d,g);const{transfers:h}=v(),n=c.useMemo(()=>{const t=x.filter(a=>a.status==="completed"),s=t.filter(a=>a.transfer_type==="incoming").reduce((a,l)=>a+(l.net_amount||l.amount||0),0),r=t.filter(a=>a.transfer_type==="outgoing").reduce((a,l)=>a+(l.net_amount||0),0),i=t.filter(a=>a.transfer_type==="outgoing").reduce((a,l)=>a+(l.commission_amount||0),0),m=s-r-i;return{totalClients:o.length,totalCompanies:u.length,totalMovements:x.length,totalReceived:s,totalSent:r,totalCommissions:i,netBalance:m}},[o,u,x]),p=c.useMemo(()=>{const t=new Map;x.forEach(r=>{const i=new Date(r.created_at),m=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`,a=i.toLocaleDateString("fr-FR",{year:"numeric",month:"short"});t.has(m)||t.set(m,{label:a,incoming:0,outgoing:0,commissions:0});const l=t.get(m);r.status==="completed"&&(r.transfer_type==="incoming"?l.incoming+=r.net_amount||r.amount||0:r.transfer_type==="outgoing"&&(l.outgoing+=r.net_amount||0,l.commissions+=r.commission_amount||0))});const s=Array.from(t.entries()).sort((r,i)=>r[0].localeCompare(i[0]));return{labels:s.map(([,r])=>r.label),incoming:s.map(([,r])=>r.incoming),outgoing:s.map(([,r])=>r.outgoing),commissions:s.map(([,r])=>r.commissions)}},[x]),y=c.useMemo(()=>{const t=x.reduce((s,r)=>(s[r.status]=(s[r.status]||0)+1,s),{});return{completed:t.completed||0,pending:t.pending||0,failed:t.failed||0}},[x]),f=c.useMemo(()=>h.slice(0,10),[h]),b=t=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),j=t=>new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),k=t=>{switch(t){case"completed":return{icon:W,color:"text-green-600",bg:"bg-green-100",label:"Terminé"};case"failed":return{icon:V,color:"text-red-600",bg:"bg-red-100",label:"Échoué"};default:return{icon:U,color:"text-orange-600",bg:"bg-orange-100",label:"En attente"}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Tableau de Bord"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Vue d'ensemble de vos activités financières"})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(I,{className:"h-4 w-4 inline mr-1 text-gray-400 dark:text-gray-500"}),"Période: ",new Date().toLocaleDateString("fr-FR",{month:"long",year:"numeric"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border border-blue-200 dark:border-blue-800 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-800/50 rounded-xl flex items-center justify-center",children:e.jsx($,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 dark:text-blue-300",children:"Clients"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400",children:"Total"})]})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-700 dark:text-blue-400",children:n.totalClients})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/30 dark:to-violet-900/30 border border-purple-200 dark:border-purple-800 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-800/50 rounded-xl flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-900 dark:text-purple-300",children:"Comptes"}),e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-400",children:"RIB actifs"})]})]}),e.jsx("div",{className:"text-2xl font-bold text-purple-700 dark:text-purple-400",children:n.totalCompanies})]}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-800/50 dark:to-slate-800/50 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center",children:e.jsx(N,{className:"h-6 w-6 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-300",children:"Mouvements"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-400",children:"Ce mois"})]})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-700 dark:text-gray-400",children:n.totalMovements})]}),e.jsxs("div",{className:`${n.netBalance>=0?"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 border-green-200 dark:border-green-800":"bg-gradient-to-r from-red-50 to-rose-50 dark:from-red-900/30 dark:to-rose-900/30 border-red-200 dark:border-red-800"} border rounded-2xl p-6 shadow-sm`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:`w-12 h-12 ${n.netBalance>=0?"bg-green-100 dark:bg-green-800/50":"bg-red-100 dark:bg-red-800/50"} rounded-xl flex items-center justify-center`,children:e.jsx(T,{className:`h-6 w-6 ${n.netBalance>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-semibold ${n.netBalance>=0?"text-green-900 dark:text-green-300":"text-red-900 dark:text-red-300"}`,children:"Solde Net"}),e.jsx("p",{className:`text-sm ${n.netBalance>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"}`,children:"Ce mois"})]})]}),e.jsx("div",{className:`text-2xl font-bold ${n.netBalance>=0?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"}`,children:b(n.netBalance)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/30 border border-green-200 dark:border-green-800 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-800/50 rounded-xl flex items-center justify-center",children:e.jsx(E,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-green-900 dark:text-green-300",children:"Total Reçu"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400",children:"Virements entrants"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-green-700 dark:text-green-400",children:["+",b(n.totalReceived)]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-rose-50 dark:from-red-900/30 dark:to-rose-900/30 border border-red-200 dark:border-red-800 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-800/50 rounded-xl flex items-center justify-center",children:e.jsx(B,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-red-900 dark:text-red-300",children:"Total Envoyé"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-400",children:"Virements sortants"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-red-700 dark:text-red-400",children:["-",b(n.totalSent)]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 border border-orange-200 dark:border-orange-800 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-800/50 rounded-xl flex items-center justify-center",children:e.jsx(R,{className:"h-6 w-6 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-orange-900 dark:text-orange-300",children:"Commissions"}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-400",children:"Total perçu"})]})]}),e.jsxs("div",{className:"text-3xl font-bold text-orange-700 dark:text-orange-400",children:["+",b(n.totalCommissions)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(L,{data:p}),e.jsx(P,{data:y})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden transition-colors duration-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-100 dark:border-gray-700 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/50 rounded-lg flex items-center justify-center mr-3",children:e.jsx(N,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),"Mouvements Récents",e.jsx("span",{className:"ml-3 px-2 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 rounded-full text-sm font-semibold",children:"Derniers 10"})]})}),e.jsx("div",{className:"hidden lg:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Mouvement"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Montant"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700",children:f.map(t=>{var m,a,l;const s=t.transfer_type==="incoming",r=k(t.status),i=r.icon;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-300",children:j(t.created_at)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 dark:bg-purple-900/50 rounded-full flex items-center justify-center mr-3",children:e.jsx(_,{className:"h-4 w-4 text-purple-600 dark:text-purple-400"})}),e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-300",children:((m=t.client)==null?void 0:m.name)||"Client inconnu"})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`flex items-center px-3 py-1 rounded-full text-sm font-medium ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[s?e.jsx(w,{className:"h-4 w-4 mr-1"}):e.jsx(C,{className:"h-4 w-4 mr-1"}),s?"Entrant":"Sortant"]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-300",children:[(a=t.debit_company)==null?void 0:a.name," → ",(l=t.credit_company)==null?void 0:l.name]}),t.note&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate max-w-48",children:t.note})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:`text-sm font-bold ${s?"text-green-600":"text-red-600"}`,children:[s?"+":"-",b(t.net_amount||t.amount)]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.bg} dark:${r.bg.replace("bg-","bg-").replace("-50","-900/50").replace("-100","-800/50")} ${r.color} dark:${r.color.replace("-600","-400").replace("-700","-300")}`,children:[e.jsx(i,{className:"h-3 w-3 mr-1"}),r.label]})})]},t.id)})})]})}),e.jsx("div",{className:"lg:hidden divide-y divide-gray-100 dark:divide-gray-700",children:f.map(t=>{var m,a,l;const s=t.transfer_type==="incoming",r=k(t.status),i=r.icon;return e.jsxs("div",{className:"p-4 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s?"bg-green-50":"bg-red-50"}`,children:s?e.jsx(w,{className:"h-5 w-5 text-green-600"}):e.jsx(C,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-300 text-sm",children:((m=t.client)==null?void 0:m.name)||"Client inconnu"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:j(t.created_at)})]})]}),e.jsxs("div",{className:`text-base font-bold ${s?"text-green-600":"text-red-600"}`,children:[s?"+":"-",b(t.net_amount||t.amount)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 truncate flex-1",children:[(a=t.debit_company)==null?void 0:a.name," → ",(l=t.credit_company)==null?void 0:l.name]}),e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.bg} dark:${r.bg.replace("bg-","bg-").replace("-50","-900/50").replace("-100","-800/50")} ${r.color} dark:${r.color.replace("-600","-400").replace("-700","-300")} ml-2`,children:[e.jsx(i,{className:"h-3 w-3 mr-1"}),r.label]})]})]},t.id)})})]})]})};export{H as default};
